<app-navbar></app-navbar>
<button class="btn btn-primary  volver mt-4 ms-4" (click)="volverAlHome()">
      <i class="fas fa-arrow-left"></i>
      <span> <svg xmlns="http://www.w3.org/2000/svg" width="16" height="16" fill="currentColor" class="bi bi-arrow-return-left" viewBox="0 0 16 16">
  <path fill-rule="evenodd" d="M14.5 1.5a.5.5 0 0 1 .5.5v4.8a2.5 2.5 0 0 1-2.5 2.5H2.707l3.347 3.346a.5.5 0 0 1-.708.708l-4.2-4.2a.5.5 0 0 1 0-.708l4-4a.5.5 0 1 1 .708.708L2.707 8.3H12.5A1.5 1.5 0 0 0 14 6.8V2a.5.5 0 0 1 .5-.5"/>
</svg> Volver al Home</span></button>
<div class="op-container">
  
    <!-- Panel izquierdo: Consultar OP -->
  <div class="consultar-op-panel">
    <div class="panel-header">
      <h2>Consultar OP</h2>
    </div>
    
    <!-- Barra de búsqueda -->
    <div class="search-bar">
      <input 
        type="text" 
        placeholder="Ingrese el número de OP..."
        aria-label="search"
        [(ngModel)]="searchTerm"
        (keyup.enter)="searchByOP()"
        (input)="onSearchInput()"
        class="form-control buscador" 
        pattern="[0-9]*"
        inputmode="numeric"
      >
      <button class="btn btn-outline-success" [class.loading]="isLoading" (click)="searchByOP()" [disabled]="isLoading">
        <i class="fas fa-search" *ngIf="!isLoading"></i>
        <i class="fas fa-spinner fa-spin" *ngIf="isLoading"></i>
        <span>Buscar</span>
      </button>
      <button class="btn btn-outline-secondary" (click)="clearSearch()">
        <i class="fas fa-trash"></i>
        <span>Limpiar filtro</span>
      </button>
    </div>

   

    <div class="results-table-container" *ngIf="searchResults.length > 0">
      <table class="results-table">
        <thead>
          <tr>
            <th>OP</th>
            <th>Descripción</th>
            <th>Referencia</th>
            <th>Cantidad</th>
          </tr>
        </thead>
        <tbody>
          <tr 
            *ngFor="let product of searchResults; trackBy: trackByProduct"
            [class.selected]="selectedProduct?.id === product.id"
            (click)="selectProduct(product)"
          >
            <td class="op-link">{{ product.op }}</td>
            <td>{{ product.description }}</td>
            <td>{{ product.reference }}</td>
            <td>{{ product.quantity }}</td>
          </tr>
        </tbody>
      </table>
    </div>

    <!-- Barra de progreso -->
    

    <!-- Estado de carga -->
    <div class="loading-state" *ngIf="isLoading">
      <div class="spinner"></div>
      <p>Buscando OP...</p>
    </div>

    <!-- Sin resultados -->
    <div class="no-results" *ngIf="hasSearched && !isLoading && searchResults.length === 0">
      <i class="fas fa-search"></i>
      <h3>No se encontró la OP</h3>
      <p>No existe una orden de producción con el número ingresado. Verifique el número de OP e intente nuevamente.</p>
    </div>
  </div>

  <!-- Panel derecho: Detalle OP -->
  <div class="detalle-op-panel" *ngIf="selectedProduct">
    <div class="panel-header">
      <h2>Detalle OP - {{ selectedProduct.op }}</h2>
    </div>

    <div class="product-details">
      <!-- Header del producto -->
      <div class="product-header">
        <div class="product-icon">
          <span>OP</span>
        </div>
        <div class="product-info">
          <h3>{{ selectedProduct.type }}</h3>
          <p>{{ selectedProduct.description }}</p>
        </div>
        <div class="qr-section">
          <div class="qr-icon">
            <i class="fas fa-qrcode"></i>
          </div>
          <span class="qr-number">{{ selectedProduct.id }}</span>
        </div>
      </div>

      <!-- Detalles del producto -->
      <div class="product-attributes">
        <div class="attribute-row">
          <span class="attribute-label">ID:</span>
          <span class="attribute-value">{{ selectedProduct.id }}</span>
        </div>
        <div class="attribute-row">
          <span class="attribute-label">OP:</span>
          <span class="attribute-value">{{ selectedProduct.op }}</span>
        </div>
        <div class="attribute-row">
          <span class="attribute-label">Referencia:</span>
          <span class="attribute-value">{{ selectedProduct.reference }}</span>
        </div>
        <div class="attribute-row">
          <span class="attribute-label">Marca:</span>
          <span class="attribute-value">{{ selectedProduct.brand }}</span>
        </div>
        <div class="attribute-row">
          <span class="attribute-label">Campaña:</span>
          <span class="attribute-value">{{ selectedProduct.campaign }}</span>
        </div>
        <div class="attribute-row">
          <span class="attribute-label">Tipo:</span>
          <span class="attribute-value">{{ selectedProduct.type }}</span>
        </div>
        <div class="attribute-row">
          <span class="attribute-label">Talla:</span>
          <span class="attribute-value">{{ selectedProduct.size }}</span>
        </div>
        <div class="attribute-row">
          <span class="attribute-label">Fecha Asignada:</span>
          <span class="attribute-value">{{ selectedProduct.assignedDate | date:'dd-MM-yyyy' }}</span>
        </div>
        <div class="attribute-row">
          <span class="attribute-label">Fecha Entrada:</span>
          <span class="attribute-value">{{ selectedProduct.plantEntryDate | date:'dd-MM-yyyy' }}</span>
        </div>
        <div class="attribute-row">
          <span class="attribute-label">Precio:</span>
          <span class="attribute-value">${{ selectedProduct.price | number:'1.0-0' }}</span>
        </div>
        <div class="attribute-row">
          <span class="attribute-label">Cantidad:</span>
          <span class="attribute-value">{{ selectedProduct.quantity }}</span>
        </div>
        <div class="attribute-row">
          <span class="attribute-label">Total:</span>
          <span class="attribute-value total-price">${{ (selectedProduct.price * selectedProduct.quantity) | number:'1.0-0' }}</span>
        </div>
        <div class="attribute-row">
          <span class="attribute-label">Descripción:</span>
          <span class="attribute-value">{{ selectedProduct.description }}</span>
        </div>
      </div>

      <!-- Tabla de sub-detalles -->
      <div class="sub-details-table mx-auto p-2 text-start">
        <h5>Carsil</h5>
      </div>
    </div>
  </div>
  

  <!-- Panel derecho vacío -->
  <div class="detalle-op-panel empty" *ngIf="!selectedProduct">
    <div class="panel-header">
      <h2>Detalle OP</h2>
    </div>
    <div class="empty-state">
      <i class="fas fa-info-circle"></i>
      <h3>Selecciona una OP</h3>
      <p>Haz clic en una orden de producción de la lista para ver sus detalles.</p>
    </div>
  </div>
</div>
  